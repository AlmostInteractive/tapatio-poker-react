(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,,,,,,function(e,t,a){e.exports=a(29)},,,,,function(e,t,a){},function(e,t,a){},,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(9),i=a.n(s),c=a(4),o=(a(18),a(3)),l=a(8),u=a(6),d=a(5),p=a(7),h=(a(19),Object.freeze({SelectHand:1,PlayCards:2,Battle:3,TallyPoints:4,GameOver:5})),f=a(2),m=f.b.model("Card",{value:f.b.optional(f.b.integer,-1),suit:f.b.optional(f.b.integer,-1)}).views(function(e){return{get front(){return e.value+function(e){switch(e){case 0:return"c";case 1:return"d";case 2:return"h";case 3:return"s";default:return console.error("invalid suit: "+e),"c"}}(e.suit)+".gif"},get back(){return"b.gif"}}}),y=function(){function e(t){Object(o.a)(this,e),this.store=t,this.battleResults={}}return Object(l.a)(e,[{key:"setGameState",value:function(e){switch(this.store.setState(e),e){case h.SelectHand:this.startNewRound();break;case h.PlayCards:this.store.cpu.hand.toggleSelected(0);break;case h.Battle:break;case h.TallyPoints:this.tallyPoints();break;case h.GameOver:}}},{key:"startNewGame",value:function(){this.store.reset(),this.setGameState(h.SelectHand)}},{key:"startNewRound",value:function(){var e=this;this.store.deck.length<10&&(this.shuffleNewDeck(),this.store.player.cleanTable(),this.store.cpu.cleanTable()),this.store.player.setHand(this.drawFive()),this.store.cpu.setHand(this.drawFive()),[0,1,2,3,4].shuffle().splice(0,3).forEach(function(t){e.store.cpu.hand.toggleSelected(t)})}},{key:"shuffleNewDeck",value:function(){for(var e=[],t=1;t<=13;t++)for(var a=0;a<4;a++)e.push(m.create({value:t,suit:a}));e.shuffle(),this.store.setDeck(e)}},{key:"drawFive",value:function(){for(var e=5,t=[];e--;)t.push(this.store.drawCard());return t}},{key:"holdCards",value:function(){this.store.player.hold(),this.store.cpu.hold()}},{key:"computeBattle",value:function(){if(this.store.state!==h.Battle)throw new Error("Computing battle in wrong state");var e=this.store.player.playCard(),t=this.store.cpu.playCard(),a=t.value===e.value,r=t.value>e.value,n=!a&&!r;return this.battleResults={playerCard:e,cpuCard:t,tie:a,playerWinner:n,cpuWinner:r}}},{key:"incrementPoints",value:function(){this.battleResults.playerWinner?this.store.player.incrementPoints():this.battleResults.cpuWinner&&this.store.cpu.incrementPoints()}},{key:"tallyPoints",value:function(){if(this.store.state!==h.TallyPoints)throw new Error("tallying points in wrong state");var e=this.store.player.points,t=this.store.cpu.points;3===e?e=-3:3===t&&(t=-3),this.store.player.setPoints(e),this.store.cpu.setPoints(t)}},{key:"endBattle",value:function(){this.store.player.addToPlayed(this.battleResults.playerCard),this.store.cpu.addToPlayed(this.battleResults.cpuCard),this.battleResults={},this.store.player.stillHasCards?this.setGameState(h.PlayCards):this.setGameState(h.TallyPoints)}},{key:"scorePoints",value:function(){this.store.player.scorePoints(),this.store.cpu.scorePoints(),this.store.player.score>=10||this.store.cpu.score>=10?this.setGameState(h.GameOver):this.setGameState(h.SelectHand)}}]),e}(),v=(a(22),Object.freeze({battleTime:1e3,clearTime:3e3,pointsToScoreTime:2e3,imagesDir:"images/cards/"}));var b=function(e){var t=[];e.isSelected&&t.push("selected"),e.isStacked?t.push("stacked"):e.isSpread&&t.push("spread");var a=t.join(" "),r=e.style,s=e.index,i=e.graphic,c=e.onSelected;return n.a.createElement("div",{className:"card "+a,style:r},n.a.createElement("img",{src:v.imagesDir+i,className:"card",onClick:c?function(){return c(s)}:null}))};var g=Object(c.c)(function(e){var t=e.deck;return n.a.createElement("div",{id:"".concat(e.id)},function(){if(0===t.length)return null;for(var e=t[0].back,a=[],r=0;r<parseInt(t.length/5);r++){var s=n.a.createElement(b,{isStacked:!0,graphic:e,style:{right:2*r+"px",bottom:r+"px"},key:r});a.push(s)}return a}())});a(23);var k=Object(c.c)(function(e){var t=e.hand,a=t.cards,r=t.selected;return n.a.createElement("div",{id:"".concat(e.id),className:"hand"},function(){var t=[];return a.forEach(function(a,s){var i=a.front,c=a.back,o=e.player?i:c,l=-1!==r.indexOf(s),u=e.onSelected,d=n.a.createElement(b,{key:s,index:s,isSelected:l,isSpread:!0,graphic:o,onSelected:u});t.push(d)}),t}())});a(24);var C=function(e){if(!e.card)return null;var t=e.card.front;return n.a.createElement("div",{id:"".concat(e.id),className:"battle"},e.winner?n.a.createElement("div",{className:"battle_result"},"Winner!"):"",e.tie?n.a.createElement("div",{className:"battle_result"},"Tie..."):"",n.a.createElement(b,{graphic:t}))},E=(a(25),function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(d.a)(t).apply(this,arguments))}return Object(p.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this,t=this.props.cards;return n.a.createElement("div",{id:"".concat(this.props.id),className:this.getClassName()},t.map(function(t,a){return n.a.createElement(b,{key:a,isStacked:!0,graphic:e.getGraphic(t),style:e.getStyleFor(a)})}))}}]),t}(n.a.Component)),w=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(n)))).getGraphic=function(e){return e.back},a.getStyleFor=function(e){return{right:5*e+"px"}},a.getClassName=function(){return"discard"},a}return Object(p.a)(t,e),t}(E);a(26);var S=function(e){return n.a.createElement("div",{id:"".concat(e.id),className:"score"},"score: ",e.score)};a(27);var O=function(e){return 0===e.points?null:n.a.createElement("div",{id:"".concat(e.id),className:"points"},"points: ",n.a.createElement("span",{className:e.final?"final":""},e.points))},P=(a(28),function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(d.a)(t)).call.apply(e,[this].concat(n)))).getGraphic=function(e){return e.front},a.getStyleFor=function(e){return{left:15*e+"px"}},a.getClassName=function(){return"played"},a}return Object(p.a)(t,e),t}(E)),j=function(e){function t(e){var a;return Object(o.a)(this,t),(a=Object(u.a)(this,Object(d.a)(t).call(this,e))).handleCardClick=function(e){switch(a.props.store.state){case h.SelectHand:a.selectCards(e,3);break;case h.PlayCards:a.selectCards(e,1)}},a.gameLogic=new y(e.store),a.state={},a}return Object(p.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.startNewGame()}},{key:"render",value:function(){var e=this.props.store,t=e.state===h.TallyPoints;return n.a.createElement("div",null,n.a.createElement("h1",null,"Tapatio Poker"),n.a.createElement("div",{id:"game_board"},n.a.createElement(g,{id:"deck",deck:e.deck}),n.a.createElement(k,{id:"my_hand",hand:e.player.hand,player:!0,onSelected:this.handleCardClick}),n.a.createElement(k,{id:"cpu_hand",hand:e.cpu.hand,player:!1}),n.a.createElement(w,{id:"my_discard",cards:e.player.discard}),n.a.createElement(w,{id:"cpu_discard",cards:e.cpu.discard}),n.a.createElement(P,{id:"my_played",cards:e.player.played}),n.a.createElement(P,{id:"cpu_played",cards:e.cpu.played}),n.a.createElement(C,{id:"my_battle",card:this.state.playerCard,winner:this.state.playerWinner,tie:this.state.tie}),n.a.createElement(C,{id:"cpu_battle",card:this.state.cpuCard,winner:this.state.cpuWinner,tie:this.state.tie}),n.a.createElement(O,{id:"my_points",points:e.player.points,final:t}),n.a.createElement(O,{id:"cpu_points",points:e.cpu.points,final:t}),n.a.createElement(S,{id:"my_score",score:e.player.score}),n.a.createElement(S,{id:"cpu_score",score:e.cpu.score}),this.renderGameOver()),n.a.createElement("div",null,this.renderInstructions()))}},{key:"renderInstructions",value:function(){var e=this,t=this.props.store;switch(t.state){case h.SelectHand:var a=3-t.player.hand.selected.length;return a>0?n.a.createElement("div",null,"Select ",a," more card",1===a?"":"s"," to keep"):n.a.createElement("button",{onClick:function(){return e.keepCards()}},"Keep Cards");case h.PlayCards:return t.player.hand.selected.length?n.a.createElement("button",{onClick:function(){return e.playCard()}},"Play Card"):n.a.createElement("div",null,"Select a card to play");case h.GameOver:return n.a.createElement("button",{onClick:function(){return e.startNewGame()}},"Play Again");default:return null}}},{key:"renderGameOver",value:function(){var e=this.props.store;if(e.state!==h.GameOver)return null;var t=e.player.score,a=e.cpu.score;return t===a?n.a.createElement("div",{id:"game_over"},"Tie Game!"):t>a?n.a.createElement("div",{id:"game_over"},"You Win!"):n.a.createElement("div",{id:"game_over"},"Computer Wins!")}},{key:"startNewGame",value:function(){this.gameLogic.startNewGame()}},{key:"selectCards",value:function(e,t){var a=this.props.store.player.hand;(a.isSelected(e)||a.selected.length<t)&&a.toggleSelected(e)}},{key:"keepCards",value:function(){this.gameLogic.holdCards(),this.gameLogic.setGameState(h.PlayCards)}},{key:"playCard",value:function(){var e=this,t=this.props.store;this.gameLogic.setGameState(h.Battle);var a=this.gameLogic.computeBattle(),r=a.playerCard,n=a.cpuCard;this.setState({playerCard:r,cpuCard:n}),setTimeout(function(){e.setState(a),e.gameLogic.incrementPoints()},v.battleTime);setTimeout(function(){e.setState({playerCard:null,cpuCard:null,cpuWinner:!1,playerWinner:!1,tie:!1}),e.gameLogic.endBattle(),t.state===h.TallyPoints&&setTimeout(function(){e.gameLogic.scorePoints()},v.pointsToScoreTime)},v.clearTime)}}]),t}(r.Component),T=Object(c.b)("store")(Object(c.c)(j));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var G=f.b.model("Player",{cards:f.b.array(m),selected:f.b.array(f.b.integer)}).actions(function(e){return{setCards:function(t){e.cards=t.slice()},toggleSelected:function(t){var a=e.selected.indexOf(t);-1===a?e.selected.push(t):e.selected.splice(a,1)},removeUnselectedCards:function(){for(var t=[],a=4;a>=0;a--)-1===e.selected.indexOf(a)&&t.push(Object(f.a)(e.cards[a]));return e.selected=[],t},removeSelectedCards:function(){for(var t=[],a=4;a>=0;a--)-1!==e.selected.indexOf(a)&&t.push(Object(f.a)(e.cards[a]));return e.selected=[],t}}}).views(function(e){return{isSelected:function(t){return-1!==e.selected.indexOf(t)},get stillHasCards(){return e.cards.length>0}}}),N=f.b.model("Player",{hand:f.b.optional(G,function(){return G.create()}),discard:f.b.array(m),played:f.b.array(m),points:f.b.optional(f.b.integer,0),score:f.b.optional(f.b.integer,0)}).actions(function(e){return{setHand:function(t){e.hand.setCards(t)},hold:function(){var t=e.hand.removeUnselectedCards();e.discard=e.discard.concat(t)},playCard:function(){var t=e.hand.removeSelectedCards();return console.log("removed",t),t[0]},incrementPoints:function(){e.points++},setPoints:function(t){e.points=t},scorePoints:function(){e.score=Math.max(0,e.score+e.points),e.points=0},addToPlayed:function(t){e.played.push(t)},cleanTable:function(){e.discard=[],e.played=[]}}}).views(function(e){return{get stillHasCards(){return e.hand.stillHasCards}}}),_=f.b.model("GameStore",{player:f.b.optional(N,function(){return N.create()}),cpu:f.b.optional(N,function(){return N.create()}),deck:f.b.array(m),state:f.b.optional(f.b.integer,-1)}).actions(function(e){return{setState:function(t){e.state=t},setDeck:function(t){e.deck=t},drawCard:function(){return Object(f.a)(e.deck[0])},reset:function(){e.player=N.create(),e.cpu=N.create(),e.deck=[]}}}).views(function(e){return{}});Array.prototype.shuffle=function(){for(var e,t,a=this.length;0!==a;)t=Math.floor(Math.random()*a),e=this[a-=1],this[a]=this[t],this[t]=e;return this};var x=_.create({});i.a.render(n.a.createElement(c.a,{store:x},n.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[13,1,2]]]);
//# sourceMappingURL=main.6936e316.chunk.js.map